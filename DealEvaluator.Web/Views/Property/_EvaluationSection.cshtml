@model DealEvaluator.Web.Models.PropertyDetailsViewModel

<!-- Evaluation Results -->
@if (Model.LatestEvaluation != null)
{
    <div class="card shadow-sm border-0 mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div class="card-header border-0" style="background: transparent;">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0 fw-bold text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-graph-up me-2" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07"/>
                    </svg>
                    Deal Analysis
                </h4>
                <div class="d-flex align-items-center gap-3">
                    <small class="text-white opacity-75">@Model.LatestEvaluation.CreatedAt.ToString("MMM d, yyyy h:mm tt")</small>
                    @if (Model.EvaluationHistory.Any())
                    {
                        <button class="btn btn-sm btn-light" type="button" data-bs-toggle="modal" data-bs-target="#evaluationHistoryModal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-clock-history me-1" viewBox="0 0 16 16">
                                <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z"/>
                                <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z"/>
                                <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5"/>
                            </svg>
                            View History
                        </button>
                    }
                </div>
            </div>
        </div>
        <div class="card-body p-4" style="background: rgba(255, 255, 255, 0.95); border-radius: 0 0 0.375rem 0.375rem; color: #212529;">
            <!-- Investment Strategy Tabs -->
            <ul class="nav nav-tabs mb-4" id="investmentStrategyTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="fix-flip-tab" data-bs-toggle="tab" data-bs-target="#fix-flip" type="button" role="tab" aria-controls="fix-flip" aria-selected="true">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hammer me-2" viewBox="0 0 16 16">
                            <path d="M9.972 2.508a.5.5 0 0 0-.16-.556l-.178-.129a5 5 0 0 0-2.076-.783C6.215.862 4.504 1.229 2.84 3.133H1.786a.5.5 0 0 0-.354.147L.146 4.567a.5.5 0 0 0 0 .706l2.571 2.579a.5.5 0 0 0 .708 0l1.286-1.29a.5.5 0 0 0 .146-.353V5.57l8.387 8.873A.5.5 0 0 0 14 14.5l1.5-1.5a.5.5 0 0 0 .017-.689l-9.129-8.63c.747-.456 1.772-.839 3.112-.839a.5.5 0 0 0 .472-.334"/>
                        </svg>
                        Fix & Flip
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="buy-hold-tab" data-bs-toggle="tab" data-bs-target="#buy-hold" type="button" role="tab" aria-controls="buy-hold" aria-selected="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key me-2" viewBox="0 0 16 16">
                            <path d="M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8m4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5"/>
                            <path d="M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                        </svg>
                        Buy & Hold
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="investmentStrategyTabContent">
                <!-- Fix & Flip Tab -->
                <div class="tab-pane fade show active" id="fix-flip" role="tabpanel" aria-labelledby="fix-flip-tab">
                    <div class="row g-4">
                        <!-- Base Information -->
                        @if (Model.LatestEvaluation.Arv.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-success bg-opacity-10 text-success rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house-check" viewBox="0 0 16 16">
                                            <path d="M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.708L8 2.207l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                                            <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
                                            <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">After Repair Value (ARV)</div>
                                        <div class="fs-4 fw-bold">$@Model.LatestEvaluation.Arv.Value.ToString("N0")</div>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.LatestEvaluation.RepairCost.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-warning bg-opacity-10 text-warning rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16">
                                            <path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.27 3.27a.997.997 0 0 0 1.414 0l1.586-1.586a.997.997 0 0 0 0-1.414l-3.27-3.27a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3q0-.405-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814zm9.646 10.646a.5.5 0 0 1 .708 0l2.914 2.915a.5.5 0 0 1-.707.707l-2.915-2.914a.5.5 0 0 1 0-.708M3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026z"/>
                                        </svg>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="text-muted small">Repair Cost</div>
                                            @if (Model.LatestEvaluation.RehabEstimate?.LineItems?.Any() == true)
                                            {
                                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#rehabBreakdownModal">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-list-ul me-1" viewBox="0 0 16 16">
                                                        <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                                                    </svg>
                                                    <small>View Breakdown</small>
                                                </button>
                                            }
                                        </div>
                                        <div class="fs-4 fw-bold">$@Model.LatestEvaluation.RepairCost.Value.ToString("N0")</div>
                                        @if (Model.LatestEvaluation.RehabEstimate?.LineItems?.Any() == true)
                                        {
                                            <small class="text-muted">@Model.LatestEvaluation.RehabEstimate.LineItems.Count items</small>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        <!-- Fix & Flip Specific Metrics -->
                        @if (Model.LatestEvaluation.MaxOffer.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-dark bg-opacity-10 text-dark rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-hand-thumbs-up" viewBox="0 0 16 16">
                                            <path d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2 2 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a10 10 0 0 0-.443.05 9.4 9.4 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a9 9 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.2 2.2 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.9.9 0 0 1-.121.416c-.165.288-.503.56-1.066.56z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Max Offer</div>
                                        <div class="fs-4 fw-bold">$@Model.LatestEvaluation.MaxOffer.Value.ToString("N0")</div>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.LatestEvaluation.Profit.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-success bg-opacity-10 text-success rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-graph-up-arrow" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Potential Profit</div>
                                        <div class="fs-4 fw-bold text-success">$@Model.LatestEvaluation.Profit.Value.ToString("N0")</div>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.LatestEvaluation.Roi.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-primary bg-opacity-10 text-primary rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-trophy" viewBox="0 0 16 16">
                                            <path d="M2.5.5A.5.5 0 0 1 3 0h10a.5.5 0 0 1 .5.5q0 .807-.034 1.536a3 3 0 1 1-1.133 5.89c-.79 1.865-1.878 2.777-2.833 3.011v2.173l1.425.356c.194.048.377.135.537.255L13.3 15.1a.5.5 0 0 1-.3.9H3a.5.5 0 0 1-.3-.9l1.838-1.379c.16-.12.343-.207.537-.255L6.5 13.11v-2.173c-.955-.234-2.043-1.146-2.833-3.012a3 3 0 1 1-1.132-5.89A33 33 0 0 1 2.5.5m.099 2.54a2 2 0 0 0 .72 3.935c-.333-1.05-.588-2.346-.72-3.935m10.083 3.935a2 2 0 0 0 .72-3.935c-.133 1.59-.388 2.885-.72 3.935M3.504 1q.01.775.056 1.469c.13 2.028.457 3.546.87 4.667C5.294 9.48 6.484 10 7 10a.5.5 0 0 1 .5.5v2.61a1 1 0 0 1-.757.97l-1.426.356a.5.5 0 0 0-.179.085L4.5 15h7l-.638-.479a.5.5 0 0 0-.18-.085l-1.425-.356a1 1 0 0 1-.757-.97V10.5A.5.5 0 0 1 9 10c.516 0 1.706-.52 2.57-2.864.413-1.12.74-2.64.87-4.667q.045-.694.056-1.469z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Return on Investment</div>
                                        <div class="fs-4 fw-bold">@Model.LatestEvaluation.Roi.Value.ToString("N2")%</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Cost Breakdown Section -->
                    <div class="mt-4">
                        <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#costBreakdown" aria-expanded="false" aria-controls="costBreakdown">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calculator me-2" viewBox="0 0 16 16">
                                <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
                            </svg>
                            View Cost Breakdown
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-chevron-down ms-2" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
                            </svg>
                        </button>

                        <div class="collapse mt-3" id="costBreakdown">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3">How We Calculated Your Max Offer</h6>
                                    <div class="calculation-flow">
                                        <!-- ARV Starting Point -->
                                        <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                                            <div>
                                                <strong>After Repair Value (ARV)</strong>
                                                <small class="text-muted d-block">Based on @(Model.LatestEvaluation.Comparables?.Count ?? 0) comparables</small>
                                            </div>
                                            @if (Model.LatestEvaluation.Arv.HasValue)
                                            {
                                                <span class="fs-5 fw-bold text-success">$@Model.LatestEvaluation.Arv.Value.ToString("N0")</span>
                                            }
                                        </div>

                                        <!-- Selling Costs -->
                                        @if (Model.LatestEvaluation.AgentCommission.HasValue || Model.LatestEvaluation.SellingClosingCosts.HasValue)
                                        {
                                            <div class="ms-3 mb-2">
                                                <div class="text-muted small mb-1"><strong>− Selling Costs</strong></div>
                                                @if (Model.LatestEvaluation.AgentCommission.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Agent Commission</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.AgentCommission.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                                @if (Model.LatestEvaluation.SellingClosingCosts.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Selling Closing Costs</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.SellingClosingCosts.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                            </div>
                                        }

                                        <!-- Holding Costs -->
                                        @if (Model.LatestEvaluation.PropertyTaxesCost.HasValue || Model.LatestEvaluation.InsuranceCost.HasValue || Model.LatestEvaluation.UtilitiesCost.HasValue)
                                        {
                                            <div class="ms-3 mb-2">
                                                <div class="text-muted small mb-1"><strong>− Holding Costs</strong></div>
                                                @if (Model.LatestEvaluation.PropertyTaxesCost.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Property Taxes</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.PropertyTaxesCost.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                                @if (Model.LatestEvaluation.InsuranceCost.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Insurance</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.InsuranceCost.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                                @if (Model.LatestEvaluation.UtilitiesCost.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Utilities</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.UtilitiesCost.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                            </div>
                                        }

                                        <!-- Rehab Costs -->
                                        @if (Model.LatestEvaluation.RepairCost.HasValue)
                                        {
                                            <div class="ms-3 mb-2">
                                                <div class="text-muted small mb-1"><strong>− Rehab Costs</strong></div>
                                                <div class="d-flex justify-content-between align-items-center ms-3">
                                                    <span class="small">Base Rehab Cost</span>
                                                    <span class="text-danger">−$@Model.LatestEvaluation.RepairCost.Value.ToString("N0")</span>
                                                </div>
                                                @if (Model.LatestEvaluation.ContingencyBuffer.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Contingency Buffer</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.ContingencyBuffer.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                            </div>
                                        }

                                        <!-- Financing Costs -->
                                        @if (Model.LatestEvaluation.TotalFinancingCosts.HasValue && Model.LatestEvaluation.TotalFinancingCosts.Value > 0)
                                        {
                                            <div class="ms-3 mb-2">
                                                <div class="text-muted small mb-1"><strong>− Financing Costs</strong></div>
                                                @if (Model.LatestEvaluation.DownPayment.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Down Payment</span>
                                                        <span class="text-info">$@Model.LatestEvaluation.DownPayment.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                                @if (Model.LatestEvaluation.LoanAmount.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Loan Amount</span>
                                                        <span class="text-info">$@Model.LatestEvaluation.LoanAmount.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                                @if (Model.LatestEvaluation.MonthlyPayment.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Monthly Payment</span>
                                                        <span class="text-info">$@Model.LatestEvaluation.MonthlyPayment.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                                @if (Model.LatestEvaluation.TotalInterest.HasValue)
                                                {
                                                    <div class="d-flex justify-content-between align-items-center ms-3">
                                                        <span class="small">Total Interest</span>
                                                        <span class="text-danger">−$@Model.LatestEvaluation.TotalInterest.Value.ToString("N0")</span>
                                                    </div>
                                                }
                                            </div>
                                        }

                                        <!-- Buying Costs -->
                                        @if (Model.LatestEvaluation.BuyingClosingCosts.HasValue)
                                        {
                                            <div class="ms-3 mb-2">
                                                <div class="d-flex justify-content-between align-items-center ms-3">
                                                    <span class="small"><strong>− Buying Closing Costs</strong></span>
                                                    <span class="text-danger">−$@Model.LatestEvaluation.BuyingClosingCosts.Value.ToString("N0")</span>
                                                </div>
                                            </div>
                                        }

                                        <!-- Profit Target -->
                                        @if (Model.LatestEvaluation.Profit.HasValue)
                                        {
                                            <div class="ms-3 mb-2">
                                                <div class="d-flex justify-content-between align-items-center ms-3">
                                                    <span class="small"><strong>− Desired Profit</strong></span>
                                                    <span class="text-danger">−$@Model.LatestEvaluation.Profit.Value.ToString("N0")</span>
                                                </div>
                                            </div>
                                        }

                                        <!-- Max Offer Result -->
                                        @if (Model.LatestEvaluation.MaxOffer.HasValue)
                                        {
                                            <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                                                <div>
                                                    <strong class="fs-5">Maximum Offer</strong>
                                                    <small class="text-muted d-block">Your purchase price ceiling</small>
                                                </div>
                                                <span class="fs-4 fw-bold text-primary">$@Model.LatestEvaluation.MaxOffer.Value.ToString("N0")</span>
                                            </div>
                                        }
                                    </div>

                                    <div class="alert alert-info mt-3 mb-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-info-circle me-1" viewBox="0 0 16 16">
                                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                                        </svg>
                                        <small>These cost estimates are based on your custom deal settings. You can adjust them in the Settings page.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buy & Hold Tab -->
                <div class="tab-pane fade" id="buy-hold" role="tabpanel" aria-labelledby="buy-hold-tab">
                    <div class="row g-4">
                        <!-- Base Information -->
                        @if (Model.LatestEvaluation.Arv.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-success bg-opacity-10 text-success rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house-check" viewBox="0 0 16 16">
                                            <path d="M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.708L8 2.207l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                                            <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
                                            <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Property Value</div>
                                        <div class="fs-4 fw-bold">$@Model.LatestEvaluation.Arv.Value.ToString("N0")</div>
                                    </div>
                                </div>
                            </div>
                        }

                        <!-- Buy & Hold Specific Metrics -->
                        @if (Model.LatestEvaluation.RentalIncome.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-info bg-opacity-10 text-info rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cash-coin" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"/>
                                            <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z"/>
                                            <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"/>
                                            <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Monthly Rental Income</div>
                                        <div class="fs-4 fw-bold">$@Model.LatestEvaluation.RentalIncome.Value.ToString("N0")</div>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="col-12">
                                <div class="alert alert-warning mb-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle me-2" viewBox="0 0 16 16">
                                        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                                    </svg>
                                    <strong>No rental metrics available.</strong> Create an evaluation with rental income to see Buy & Hold analysis.
                                </div>
                            </div>
                        }

                        @if (Model.LatestEvaluation.CapRate.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-danger bg-opacity-10 text-danger rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-percent" viewBox="0 0 16 16">
                                            <path d="M13.442 2.558a.625.625 0 0 1 0 .884l-10 10a.625.625 0 1 1-.884-.884l10-10a.625.625 0 0 1 .884 0M4.5 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m7 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Cap Rate</div>
                                        <div class="fs-4 fw-bold">@Model.LatestEvaluation.CapRate%</div>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.LatestEvaluation.CashOnCash.HasValue)
                        {
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <div class="feature-icon bg-secondary bg-opacity-10 text-secondary rounded-circle p-3 me-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-calculator" viewBox="0 0 16 16">
                                            <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                            <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Cash-on-Cash Return</div>
                                        <div class="fs-4 fw-bold">@Model.LatestEvaluation.CashOnCash%</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (Model.LatestEvaluation.RentalIncome.HasValue)
                    {
                        <div class="alert alert-info mt-4 mb-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle me-2" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533z"/>
                                <path d="M9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                            </svg>
                            <strong>Buy & Hold Strategy:</strong> Focuses on long-term rental income and appreciation. Consider vacancy rates and maintenance costs.
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Comparables Used in This Evaluation -->
        <div class="px-4 pb-4" style="background: rgba(255, 255, 255, 0.95); color: #212529;">
            <hr class="my-0 mb-3">
            <h6 class="fw-bold mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check2-square me-2" viewBox="0 0 16 16">
                    <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5z"/>
                    <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0"/>
                </svg>
                Comparables Used in This Evaluation
                @if (Model.LatestEvaluation.Comparables != null && Model.LatestEvaluation.Comparables.Any())
                {
                    <span class="badge bg-secondary ms-2">@Model.LatestEvaluation.Comparables.Count</span>
                }
            </h6>

            @if (Model.LatestEvaluation.Comparables != null && Model.LatestEvaluation.Comparables.Any())
            {
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Address</th>
                                <th>Type</th>
                                <th>Price</th>
                                <th>Sqft</th>
                                <th>Bed/Bath</th>
                                <th>Sale Date</th>
                                <th>Link</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var comp in Model.LatestEvaluation.Comparables)
                            {
                                <tr>
                                    <td>
                                        <div class="fw-bold small">@comp.Address</div>
                                        <small class="text-muted">@comp.City, @comp.State</small>
                                    </td>
                                    <td>
                                        <span class="badge badge-sm @(comp.ComparableType.ToString() == "Arv" ? "bg-info" : "bg-warning")">
                                            @comp.ComparableType
                                        </span>
                                    </td>
                                    <td>
                                        @if (comp.Price.HasValue)
                                        {
                                            <span class="fw-bold text-success">$@comp.Price.Value.ToString("N0")</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                    <td>
                                        @if (comp.Sqft.HasValue)
                                        {
                                            <span>@comp.Sqft.Value.ToString("N0") sf</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                    <td>
                                        @if (comp.Bedrooms.HasValue || comp.Bathrooms.HasValue)
                                        {
                                            <span>@comp.Bedrooms / @comp.Bathrooms</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                    <td>
                                        @if (comp.SaleDate.HasValue)
                                        {
                                            <span class="small">@comp.SaleDate.Value.ToString("MMM d, yyyy")</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(comp.ListingUrl))
                                        {
                                            <a href="@("https://zillow.com" + comp.ListingUrl)"
                                               target="_blank"
                                               class="btn btn-sm btn-outline-primary"
                                               title="View listing on Zillow">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
                                                    <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                                                    <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
                                                </svg>
                                            </a>
                                        }
                                        else
                                        {
                                            <span class="text-muted small">-</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-warning mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle me-2" viewBox="0 0 16 16">
                        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                    </svg>
                    <strong>No comparables selected.</strong> This is a placeholder evaluation. Create a new evaluation and select comparables for accurate analysis.
                </div>
            }
        </div>

        <!-- Visual connector to comparables pool section -->
        <div class="text-center py-3" style="background: rgba(255, 255, 255, 0.95); color: #212529;">
            <small class="text-muted d-flex align-items-center justify-content-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down me-2" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1"/>
                </svg>
                View full comparables pool below
            </small>
        </div>
    </div>
}
else
{
    <!-- No Evaluation Yet -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-4 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-graph-up text-muted mb-3" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07"/>
            </svg>
            <h4 class="mb-2">No Evaluation Yet</h4>
            <p class="text-muted mb-0">Click "Create Evaluation" to generate the first evaluation for this property.</p>
        </div>
    </div>
}